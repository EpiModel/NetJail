---
title: "Step8-LongVsShortStays"
author: "Karina Wallrafen-Sam"
date: "4/4/2022"
output: html_document
---

```{r}
if (AnalyseShortVsLong == TRUE) {
  longTermIDs <- durations[durations$startCensored == "Y" & 
                             durations$endCensored == "Y", "id"]
  longTermIDs <- longTermIDs[!duplicated(longTermIDs)]
  
  shortTermIDs <- durations[durations$startCensored == "N" & 
                              durations$endCensored == "N", "id"]
  shortTermIDs <- shortTermIDs[!duplicated(shortTermIDs)]
  
  ids$type <- NA
  ids[ids$id %in% longTermIDs, ]$type <- "Long-Term"
  ids[ids$id %in% shortTermIDs, ]$type <- "Short-Term"
  
  remove(longTermIDs, shortTermIDs)
  
  ids2 <- ids
  ids2[ids2$Race != "White" & ids2$Race != "Black", ]$Race <- "Other"
  ids2$InitialAge <- cut(ids2$InitialAge, breaks=c(0, 20, 30, 40, 50, 60, 100), 
                         right = FALSE, labels = c("Under 20", "20 - 29", 
                                                   "30 - 39", "40 - 49", 
                                                   "50 - 59", "60+"))
  
  types1 <- ids %>% group_by(type) %>% summarise(category = "Overall", numPeople = n())
  types2 <- ids2 %>% group_by(Race, type) %>% summarise(numPeople = n())
  names(types2)[names(types2) == 'Race'] <- 'category'
  types2$category <- paste("Race", types2$category)
  types3 <- ids2 %>% group_by(InitialAge, type) %>% summarise(numPeople = n())
  names(types3)[names(types3) == 'InitialAge'] <- 'category'
  types3$category <- paste("Age", types3$category)
  
  typesSummary <- rbind(types1, types2, types3)
  remove(types1, types2, types3, ids2)
  
  for (i in seq_along(allFloors)){
    currentFloor <- m_stdLoc[m_stdLoc$Floor == allFloors[i], "SoNum"]
    currentFloor <- currentFloor[!duplicated(currentFloor), ]
    currentFloor <- merge(currentFloor, ids[ ,c("SoNum", "id", "type")], by = "SoNum")
    
    currentFloorTypes <- currentFloor %>% group_by(type) %>% 
      summarise(category = paste("Floor", allFloors[i]), numPeople = n())
    
    typesSummary <- rbind(typesSummary, currentFloorTypes)
  }
  remove(currentFloor, currentFloorTypes, i)
  
  typesSummary <- typesSummary %>% group_by(category) %>%
    mutate(percentPeople = round(numPeople / sum(numPeople), 4) * 100) 
  typesSummary <- typesSummary[,c(2,1,3,4)]
  typesSummary <- typesSummary[complete.cases(typesSummary), ]
  
  print.data.frame(typesSummary[c(1:2, 21:nrow(typesSummary)), ])
}
```
